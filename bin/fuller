#!/usr/bin/env node

"use strict";

var fs = require('fs');
var path = require('path');
var args = require('args');
var Fuller = require('../lib');
var rxReserved = require('../lib/tools/plan').rxReserved;
var defaultOpts = require('../lib/defaults');

var planFile = path.join(process.cwd(), 'plan.js');
if (!fs.existsSync(planFile)) {
    console.log('Error: can\'t find a plan');
    process.exit(1);
}

var task, runTask, plan = require(planFile);

for(task in plan) {
    if(rxReserved.test(task) === -1) {
        defaultOpts.push({
            name: task,
            type: 'bool',
            defaultValue: false
        });
    }
}

var options = args.Options.parse(defaultOpts);

try {
	var opt = args.parse(options);
} catch (err) {
	console.log(options.getHelp());
	process.exit(1);
}

for(task in plan) {
    if(task !== 'dev' && opt[task]) {
        runTask = task;
        break;
    }
}

var fuller = new Fuller("plan.js", runTask, opt);
